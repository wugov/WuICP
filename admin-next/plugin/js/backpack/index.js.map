{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@blockly/workspace-backpack/webpack/universalModuleDefinition","webpack://@blockly/workspace-backpack/external umd {\"root\":\"Blockly\",\"commonjs\":\"blockly/core\",\"commonjs2\":\"blockly/core\",\"amd\":\"blockly/core\"}","webpack://@blockly/workspace-backpack/webpack/bootstrap","webpack://@blockly/workspace-backpack/webpack/runtime/define property getters","webpack://@blockly/workspace-backpack/webpack/runtime/hasOwnProperty shorthand","webpack://@blockly/workspace-backpack/webpack/runtime/make namespace object","webpack://@blockly/workspace-backpack/./src/msg.ts","webpack://@blockly/workspace-backpack/./src/ui_events.ts","webpack://@blockly/workspace-backpack/./src/backpackable.ts","webpack://@blockly/workspace-backpack/./src/backpack.ts","webpack://@blockly/workspace-backpack/./src/options.ts","webpack://@blockly/workspace-backpack/./src/backpack_helpers.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"blockly/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"blockly/core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"blockly/core\")) : factory(root[\"Blockly\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, (__WEBPACK_EXTERNAL_MODULE__370__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__370__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Translatable messages used in backpack.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\n\n// context menu - Copy all Blocks on the workspace to the backpack.\nBlockly.Msg['COPY_ALL_TO_BACKPACK'] = 'Copy All Blocks to Backpack';\n// context menu - Copy the selected Block to the backpack.\nBlockly.Msg['COPY_TO_BACKPACK'] = 'Copy to Backpack';\n// context menu - Empty the backpack.\nBlockly.Msg['EMPTY_BACKPACK'] = 'Empty';\n// context menu - Paste all Blocks from the backpack to the workspace.\nBlockly.Msg['PASTE_ALL_FROM_BACKPACK'] = 'Paste All Blocks from Backpack';\n// context menu - Remove the selected Block from the backpack.\nBlockly.Msg['REMOVE_FROM_BACKPACK'] = 'Remove from Backpack';\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview UI events used for the backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\n\n/**\n * Name of event that records a backpack open.\n */\nexport const backpackOpen = 'backpack_open';\n\n/**\n * A UI event representing a backpack opening or closing.\n */\nexport class BackpackOpen extends Blockly.Events.UiBase {\n  /**\n   * Type of this event.\n   */\n  type = backpackOpen;\n\n  /**\n   * Class for a backpack open event.\n   *\n   * @param isOpen Whether the backpack flyout is opening (false\n   *    if closing). Undefined for a blank event.\n   * @param workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    public isOpen?: boolean,\n    workspaceId?: string,\n  ) {\n    super(workspaceId);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): BackpackOpenEventJson {\n    const json = super.toJson() as BackpackOpenEventJson;\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   * @param workspace A workspace to create the event on.\n   * @param event an instance of BackpackOpen to deserialize into.\n   * @returns A newly deserialized BackpackOpen event.\n   */\n  static fromJson(\n    json: BackpackOpenEventJson,\n    workspace: Blockly.Workspace,\n    event: unknown,\n  ): BackpackOpen {\n    const newEvent = super.fromJson(json, workspace, event) as BackpackOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface BackpackOpenEventJson\n  extends Blockly.Events.AbstractEventJson {\n  isOpen?: boolean;\n}\n\nBlockly.registry.register(\n  Blockly.registry.Type.EVENT,\n  backpackOpen,\n  BackpackOpen,\n);\n\n/**\n * Name of event that records a backpack change.\n */\nexport const backpackChange = 'backpack_change';\n\n/**\n * A UI event representing a change in a backpack's contents.\n */\nexport class BackpackChange extends Blockly.Events.UiBase {\n  /**\n   * Type of this event.\n   */\n  type = backpackChange;\n}\n\nBlockly.registry.register(\n  Blockly.registry.Type.EVENT,\n  backpackChange,\n  BackpackChange,\n);\n","/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as Blockly from 'blockly/core';\n\n/** Defines if an object can be added to the backpack. */\nexport interface Backpackable {\n  /**\n   * @return A representation of this object as a FlyoutItemInfo array, so that\n   * it can be displayed in the backpack.\n   *\n   * This method should remove any unique or useless state data (e.g. IDs or\n   * coordinates).\n   */\n  toFlyoutInfo(): Blockly.utils.toolbox.FlyoutItemInfo[];\n}\n\n/**\n * @param obj The object we want to check is a Backpackable or not.\n * @return Whether the given object conforms to the Backpackable interface.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isBackpackable(obj: any): obj is Backpackable {\n  return obj.toFlyoutInfo !== undefined;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A backpack that lives on top of the workspace.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\n/* eslint-disable @typescript-eslint/naming-convention */\n\nimport * as Blockly from 'blockly/core';\n\nimport {registerContextMenus} from './backpack_helpers';\nimport {BackpackOptions, parseOptions} from './options';\nimport {BackpackChange, BackpackOpen} from './ui_events';\nimport {Backpackable, isBackpackable} from './backpackable';\n\n/**\n * Class for backpack that can be used save blocks from the workspace for\n * future use.\n */\nexport class Backpack\n  extends Blockly.DragTarget\n  implements Blockly.IAutoHideable, Blockly.IPositionable\n{\n  /** The unique id for this component. */\n  id = 'backpack';\n\n  /**\n   * The backpack options, such as which context menus to show, whether to\n   * allow opening the backpack when empty and whether to use a different\n   * image when the backpack contains blocks.\n   */\n  private options: BackpackOptions;\n\n  /** The backpack flyout. Initialized during init. */\n  protected flyout_: Blockly.IFlyout | null = null;\n\n  /** A list of JSON (stored as strings) representing blocks in the backpack. */\n  protected contents_: string[] = [];\n\n  /** Array holding info needed to unbind events. Used for disposing. */\n  private boundEvents: Blockly.browserEvents.Data[] = [];\n\n  /** Left coordinate of the backpack in pixels. */\n  protected left_ = 0;\n\n  /** Top coordinate of the backpack in pixels. */\n  protected top_ = 0;\n\n  /** Width of the backpack in pixels. Used for clip path. */\n  protected readonly WIDTH_ = 40;\n\n  /** Height of the backpack in pixels. Used for clip path. */\n  protected readonly HEIGHT_ = 60;\n\n  /** Distance between backpack and bottom/top edge of workspace in pixels. */\n  protected readonly MARGIN_VERTICAL_ = 20;\n\n  /** Distance between backpack and right/left edge of workspace in pixels. */\n  protected readonly MARGIN_HORIZONTAL_ = 20;\n\n  /** Extent of hotspot on all sides beyond the size of the image in pixels. */\n  protected readonly HOTSPOT_MARGIN_ = 10;\n\n  /** The SVG group containing the backpack. */\n  protected svgGroup_: SVGElement | null = null;\n\n  /** The SVG image of the backpack. */\n  protected svgImg_: SVGImageElement | null = null;\n\n  /** Top offset for backpack svg in pixels. */\n  private spriteTop = 10;\n\n  /** Left offset for backpack svg in pixels. */\n  private spriteLeft = 20;\n\n  /** Width/Height of svg in pixels. */\n  private readonly spriteSize = 80;\n\n  /** Whether or not the plugin has been initialized. */\n  protected initialized_ = false;\n\n  /**\n   * Constructor for a backpack.\n   *\n   * @param workspace_ The target workspace that\n   *     the backpack will be added to.\n   * @param backpackOptions The backpack options to use.\n   */\n  constructor(\n    protected workspace_: Blockly.WorkspaceSvg,\n    backpackOptions?: BackpackOptions,\n  ) {\n    super();\n    this.options = parseOptions(backpackOptions);\n    this.registerSerializer();\n  }\n\n  /**\n   * Registers serializer if options.skipSerializerRegistration is false\n   * and it hasn't been registered already.\n   */\n  private registerSerializer() {\n    if (this.options.skipSerializerRegistration) {\n      return;\n    }\n\n    if (\n      Blockly.registry.hasItem(Blockly.registry.Type.SERIALIZER, 'backpack')\n    ) {\n      return;\n    }\n\n    Blockly.serialization.registry.register(\n      'backpack',\n      new BackpackSerializer(),\n    );\n  }\n\n  /**\n   * Initializes the backpack.\n   */\n  init() {\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [\n        Blockly.ComponentManager.Capability.AUTOHIDEABLE,\n        Blockly.ComponentManager.Capability.DRAG_TARGET,\n        Blockly.ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initFlyout();\n    this.createDom();\n    this.attachListeners();\n    if (this.options.contextMenu) {\n      registerContextMenus(this.options.contextMenu, this.workspace_);\n    }\n    this.initialized_ = true;\n    this.workspace_.resize();\n  }\n\n  /**\n   * Disposes of workspace search.\n   * Unlink from all DOM elements and remove all event listeners\n   * to prevent memory leaks.\n   */\n  dispose() {\n    if (this.svgGroup_) {\n      Blockly.utils.dom.removeNode(this.svgGroup_);\n    }\n    for (const event of this.boundEvents) {\n      Blockly.browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n  }\n\n  /**\n   * Creates and initializes the flyout and inserts it into the dom.\n   */\n  protected initFlyout() {\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Blockly.Options({\n      scrollbars: true,\n      parentWorkspace: this.workspace_,\n      rtl: this.workspace_.RTL,\n      oneBasedIndex: this.workspace_.options.oneBasedIndex,\n      renderer: this.workspace_.options.renderer,\n      rendererOverrides: this.workspace_.options.rendererOverrides || undefined,\n      move: {\n        scrollbars: true,\n      },\n    });\n    // Create vertical or horizontal flyout.\n    if (this.workspace_.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace_.toolboxPosition === Blockly.utils.toolbox.Position.TOP\n          ? Blockly.utils.toolbox.Position.BOTTOM\n          : Blockly.utils.toolbox.Position.TOP;\n      const HorizontalFlyout = Blockly.registry.getClassFromOptions(\n        Blockly.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.workspace_.options,\n        true,\n      );\n      if (HorizontalFlyout) {\n        this.flyout_ = new HorizontalFlyout(flyoutWorkspaceOptions);\n      } else {\n        throw new Error('HorizontalFlyout does not exist');\n      }\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace_.toolboxPosition === Blockly.utils.toolbox.Position.RIGHT\n          ? Blockly.utils.toolbox.Position.LEFT\n          : Blockly.utils.toolbox.Position.RIGHT;\n      const VerticalFlyout = Blockly.registry.getClassFromOptions(\n        Blockly.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.workspace_.options,\n        true,\n      );\n      if (VerticalFlyout) {\n        this.flyout_ = new VerticalFlyout(flyoutWorkspaceOptions);\n      } else {\n        throw new Error('VerticalFlyout does not exist');\n      }\n    }\n    // Add flyout to DOM.\n    const parentNode = this.workspace_.getParentSvg().parentNode;\n    parentNode?.appendChild(this.flyout_?.createDom(Blockly.utils.Svg.SVG));\n    this.flyout_.init(this.workspace_);\n  }\n\n  /**\n   * Creates DOM for UI element.\n   */\n  protected createDom() {\n    this.svgGroup_ = Blockly.utils.dom.createSvgElement(\n      Blockly.utils.Svg.G,\n      {},\n      null,\n    );\n    const rnd = Blockly.utils.idGenerator.genUid();\n    const clip = Blockly.utils.dom.createSvgElement(\n      Blockly.utils.Svg.CLIPPATH,\n      {id: 'blocklyBackpackClipPath' + rnd},\n      this.svgGroup_,\n    );\n    Blockly.utils.dom.createSvgElement(\n      Blockly.utils.Svg.RECT,\n      {\n        width: this.WIDTH_,\n        height: this.HEIGHT_,\n      },\n      clip,\n    );\n    this.svgImg_ = Blockly.utils.dom.createSvgElement(\n      Blockly.utils.Svg.IMAGE,\n      {\n        'class': 'blocklyBackpack',\n        'clip-path': 'url(#blocklyBackpackClipPath' + rnd + ')',\n        'width': this.spriteSize + 'px',\n        'x': -this.spriteLeft,\n        'height': this.spriteSize + 'px',\n        'y': -this.spriteTop,\n      },\n      this.svgGroup_,\n    );\n    this.svgImg_.setAttributeNS(\n      Blockly.utils.dom.XLINK_NS,\n      'xlink:href',\n      backpackSvgDataUri,\n    );\n\n    Blockly.utils.dom.insertAfter(\n      this.svgGroup_,\n      this.workspace_.getBubbleCanvas(),\n    );\n  }\n\n  /**\n   * Attaches event listeners.\n   */\n  protected attachListeners() {\n    if (!this.svgGroup_) return;\n    this.addEvent(\n      this.svgGroup_,\n      'mousedown',\n      this,\n      this.blockMouseDownWhenOpenable,\n    );\n    this.addEvent(this.svgGroup_, 'mouseup', this, this.onClick);\n    this.addEvent(this.svgGroup_, 'mouseover', this, this.onMouseOver);\n    this.addEvent(this.svgGroup_, 'mouseout', this, this.onMouseOut);\n  }\n\n  /**\n   * Helper method for adding an event.\n   *\n   * @param node Node upon which to listen.\n   * @param name Event name to listen to (e.g. 'mousedown').\n   * @param thisObject The value of 'this' in the function.\n   * @param func Function to call when event is triggered.\n   */\n  private addEvent(\n    node: Element,\n    name: string,\n    thisObject: object,\n    func: (event: Event) => void,\n  ) {\n    const event = Blockly.browserEvents.bind(node, name, thisObject, func);\n    this.boundEvents.push(event);\n  }\n\n  /**\n   * Returns the backpack flyout.\n   *\n   * @returns The backpack flyout.\n   */\n  getFlyout(): Blockly.IFlyout | null {\n    return this.flyout_;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag\n   *   target area should be ignored.\n   */\n  getClientRect(): Blockly.utils.Rect | null {\n    if (!this.svgGroup_) {\n      return null;\n    }\n\n    const clientRect = this.svgGroup_.getBoundingClientRect();\n    const top = clientRect.top + this.spriteTop - this.HOTSPOT_MARGIN_;\n    const bottom = top + this.HEIGHT_ + 2 * this.HOTSPOT_MARGIN_;\n    const left = clientRect.left + this.spriteLeft - this.HOTSPOT_MARGIN_;\n    const right = left + this.WIDTH_ + 2 * this.HOTSPOT_MARGIN_;\n    return new Blockly.utils.Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The component’s bounding box.\n   */\n  getBoundingRectangle(): Blockly.utils.Rect {\n    return new Blockly.utils.Rect(\n      this.top_,\n      this.top_ + this.HEIGHT_,\n      this.left_,\n      this.left_ + this.WIDTH_,\n    );\n  }\n\n  /**\n   * Positions the backpack.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that\n   *     are already on the workspace.\n   */\n  position(\n    metrics: Blockly.MetricsManager.UiMetrics,\n    savedPositions: Blockly.utils.Rect[],\n  ) {\n    if (!this.initialized_) {\n      return;\n    }\n\n    const scrollbars = this.workspace_.scrollbar;\n    const hasVerticalScrollbars =\n      scrollbars && scrollbars.isVisible() && scrollbars.canScrollVertically();\n    const hasHorizontalScrollbars =\n      scrollbars &&\n      scrollbars.isVisible() &&\n      scrollbars.canScrollHorizontally();\n\n    if (\n      metrics.toolboxMetrics.position === Blockly.TOOLBOX_AT_LEFT ||\n      (this.workspace_.horizontalLayout && !this.workspace_.RTL)\n    ) {\n      // Right corner placement.\n      this.left_ =\n        metrics.absoluteMetrics.left +\n        metrics.viewMetrics.width -\n        this.WIDTH_ -\n        this.MARGIN_HORIZONTAL_;\n      if (hasVerticalScrollbars && !this.workspace_.RTL) {\n        this.left_ -= Blockly.Scrollbar.scrollbarThickness;\n      }\n    } else {\n      // Left corner placement.\n      this.left_ = this.MARGIN_HORIZONTAL_;\n      if (hasVerticalScrollbars && this.workspace_.RTL) {\n        this.left_ += Blockly.Scrollbar.scrollbarThickness;\n      }\n    }\n\n    const startAtBottom =\n      metrics.toolboxMetrics.position === Blockly.TOOLBOX_AT_BOTTOM;\n    if (startAtBottom) {\n      // Bottom corner placement\n      this.top_ =\n        metrics.absoluteMetrics.top +\n        metrics.viewMetrics.height -\n        this.HEIGHT_ -\n        this.MARGIN_VERTICAL_;\n      if (hasHorizontalScrollbars) {\n        // The horizontal scrollbars are always positioned on the bottom.\n        this.top_ -= Blockly.Scrollbar.scrollbarThickness;\n      }\n    } else {\n      // Upper corner placement\n      this.top_ = metrics.absoluteMetrics.top + this.MARGIN_VERTICAL_;\n    }\n\n    // Check for collision and bump if needed.\n    let boundingRect = this.getBoundingRectangle();\n    for (let i = 0, otherEl; (otherEl = savedPositions[i]); i++) {\n      if (boundingRect.intersects(otherEl)) {\n        if (startAtBottom) {\n          // Bump up.\n          this.top_ = otherEl.top - this.HEIGHT_ - this.MARGIN_VERTICAL_;\n        } else {\n          // Bump down.\n          this.top_ = otherEl.bottom + this.MARGIN_VERTICAL_;\n        }\n        // Recheck other savedPositions\n        boundingRect = this.getBoundingRectangle();\n        i = -1;\n      }\n    }\n\n    if (this.svgGroup_) {\n      this.svgGroup_.setAttribute(\n        'transform',\n        `translate(${this.left_},${this.top_})`,\n      );\n    }\n  }\n\n  /**\n   * Returns the count of items in the backpack.\n   *\n   * @returns The count of items.\n   */\n  getCount(): number {\n    return this.contents_.length;\n  }\n\n  /**\n   * Returns backpack contents.\n   *\n   * @returns The backpack contents.\n   */\n  getContents(): string[] {\n    // Return a shallow copy of the contents array.\n    return [...this.contents_];\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDrop(dragElement: Blockly.IDraggable) {\n    if (isBackpackable(dragElement)) {\n      this.addBackpackable(dragElement);\n    }\n  }\n\n  /**\n   * Converts the provided block into a JSON string and\n   * cleans the JSON of any unnecessary attributes\n   *\n   * @param block The block to convert.\n   * @returns The JSON object as a string.\n   */\n  private blockToJsonString(block: Blockly.Block): string {\n    const json = Blockly.serialization.blocks.save(block);\n\n    // Add a 'kind' key so the flyout can recognize it as a block.\n    (json as Blockly.utils.toolbox.FlyoutItemInfo).kind = 'BLOCK';\n\n    // The keys to remove.\n    const keys = ['id', 'height', 'width', 'pinned', 'enabled'];\n\n    // Traverse the JSON recursively.\n    const traverseJson = function (json: StateWithIndex, keys: string[]) {\n      for (const key in json) {\n        if (key) {\n          if (keys.indexOf(key) !== -1) {\n            delete json[key];\n          }\n          if (json[key] && typeof json[key] === 'object') {\n            traverseJson(json[key] as StateWithIndex, keys);\n          }\n        }\n      }\n    };\n\n    if (json) {\n      traverseJson(json as StateWithIndex, keys);\n    }\n    return JSON.stringify(json);\n  }\n\n  /**\n   * Converts serialized XML to its equivalent serialized JSON string\n   *\n   * @param blockXml The XML serialized block.\n   * @returns The JSON object as a string.\n   */\n  private blockXmlToJsonString(blockXml: string): string {\n    if (!blockXml.startsWith('<block')) {\n      throw new Error('Unrecognized XML format');\n    }\n\n    const workspace = new Blockly.Workspace();\n    try {\n      const block = Blockly.Xml.domToBlock(\n        Blockly.utils.xml.textToDom(blockXml),\n        workspace,\n      );\n      return this.blockToJsonString(block);\n    } finally {\n      workspace.dispose();\n    }\n  }\n\n  /**\n   * Returns whether the backpack contains a duplicate of the provided Block.\n   *\n   * @param block The block to check.\n   * @returns Whether the backpack contains a duplicate of the\n   *     provided block.\n   */\n  containsBlock(block: Blockly.Block): boolean {\n    if (isBackpackable(block)) {\n      return this.containsBackpackable(block);\n    } else {\n      return this.contents_.indexOf(this.blockToJsonString(block)) !== -1;\n    }\n  }\n\n  /**\n   * Adds the specified block to backpack.\n   *\n   * @param block The block to be added to the backpack.\n   */\n  addBlock(block: Blockly.Block) {\n    if (isBackpackable(block)) {\n      this.addBackpackable(block);\n    } else {\n      this.addItem(this.blockToJsonString(block));\n    }\n  }\n\n  /**\n   * Adds the provided blocks to backpack.\n   *\n   * @param blocks The blocks to be added to the\n   *     backpack.\n   */\n  addBlocks(blocks: Blockly.Block[]) {\n    for (const block of blocks) {\n      if (isBackpackable(block)) {\n        this.addBackpackable(block);\n      } else {\n        this.addItem(this.blockToJsonString(block));\n      }\n    }\n  }\n\n  /**\n   * Removes the specified block from the backpack.\n   *\n   * @param block The block to be removed from the backpack.\n   */\n  removeBlock(block: Blockly.Block) {\n    if (isBackpackable(block)) {\n      this.removeBackpackable(block);\n    } else {\n      this.removeItem(this.blockToJsonString(block));\n    }\n  }\n\n  /**\n   * @param backpackable The backpackable we want to check for existence within\n   *     the backpack.\n   * @return whether the backpack contains a duplicate of the provided\n   *     backpackable.\n   */\n  containsBackpackable(backpackable: Backpackable): boolean {\n    return backpackable\n      .toFlyoutInfo()\n      .every((info) => this.contents_.indexOf(JSON.stringify(info)) !== -1);\n  }\n\n  /**\n   * @param backpackable The backpackable to add to the backpack.\n   */\n  addBackpackable(backpackable: Backpackable) {\n    this.addBackpackables([backpackable]);\n  }\n\n  /** @param backpackables The backpackables to add to the backpack. */\n  addBackpackables(backpackables: Backpackable[]) {\n    this.addItems(\n      backpackables\n        .map((b) => b.toFlyoutInfo())\n        .reduce((acc, curr) => [...acc, ...curr])\n        .map((info) => JSON.stringify(info)),\n    );\n  }\n\n  /** @param backpackable The backpackable to remove from the backpack. */\n  removeBackpackable(backpackable: Backpackable) {\n    for (const info of backpackable.toFlyoutInfo()) {\n      this.removeItem(JSON.stringify(info));\n    }\n  }\n\n  /**\n   * Adds item to backpack.\n   *\n   * @param item Text representing the JSON of a block to add,\n   *     cleaned of all unnecessary attributes.\n   */\n  addItem(item: string) {\n    this.addItems([item]);\n  }\n\n  /**\n   * Adds multiple items to the backpack.\n   *\n   * @param items The backpack contents to add.\n   */\n  addItems(items: string[]) {\n    const addedItems = this.filterDuplicates(items);\n    if (addedItems.length) {\n      this.contents_.unshift(...addedItems);\n      this.onContentChange();\n    }\n  }\n\n  /**\n   * Removes item from the backpack.\n   *\n   * @param item Text representing the JSON of a block to remove,\n   * cleaned of all unnecessary attributes.\n   */\n  removeItem(item: string) {\n    const itemIndex = this.contents_.indexOf(item);\n    if (itemIndex !== -1) {\n      this.contents_.splice(itemIndex, 1);\n      this.onContentChange();\n    }\n  }\n\n  /**\n   * Sets backpack contents.\n   *\n   * @param contents The new backpack contents.\n   */\n  setContents(contents: string[]) {\n    this.contents_ = [];\n    this.contents_ = this.filterDuplicates(\n      // Support XML serialized content for backwards compatiblity:\n      // https://github.com/google/blockly-samples/issues/1827\n      contents.map((content) =>\n        content.startsWith('<block')\n          ? this.blockXmlToJsonString(content)\n          : content,\n      ),\n    );\n    this.onContentChange();\n  }\n\n  /**\n   * Empties the backpack's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  empty() {\n    if (!this.getCount()) {\n      return;\n    }\n    if (this.contents_.length) {\n      this.contents_ = [];\n      this.onContentChange();\n    }\n    this.close();\n  }\n\n  /**\n   * Handles content change.\n   */\n  protected onContentChange() {\n    this.maybeRefreshFlyoutContents();\n    Blockly.Events.fire(new BackpackChange(this.workspace_.id));\n\n    if (!this.options.useFilledBackpackImage || !this.svgImg_) return;\n    if (this.contents_.length > 0) {\n      this.svgImg_.setAttributeNS(\n        Blockly.utils.dom.XLINK_NS,\n        'xlink:href',\n        backpackFilledSvgDataUri,\n      );\n    } else {\n      this.svgImg_.setAttributeNS(\n        Blockly.utils.dom.XLINK_NS,\n        'xlink:href',\n        backpackSvgDataUri,\n      );\n    }\n  }\n\n  /**\n   * Returns a filtered list without duplicates within itself and without any\n   * shared elements with this.contents_.\n   *\n   * @param array The array of items to filter.\n   * @returns The filtered list.\n   */\n  private filterDuplicates(array: string[]): string[] {\n    return array.filter((item, idx) => {\n      return array.indexOf(item) === idx && this.contents_.indexOf(item) === -1;\n    });\n  }\n\n  /**\n   * Returns whether the backpack is open-able.\n   *\n   * @returns Whether the backpack is open-able.\n   */\n  protected isOpenable(): boolean {\n    return !this.isOpen() && this.options.allowEmptyBackpackOpen\n      ? true\n      : this.getCount() > 0;\n  }\n\n  /**\n   * Returns whether the backpack is open.\n   *\n   * @returns Whether the backpack is open.\n   */\n  isOpen(): boolean {\n    return this.flyout_ ? this.flyout_.isVisible() : false;\n  }\n\n  /**\n   * Opens the backpack flyout.\n   */\n  open() {\n    if (!this.isOpenable()) {\n      return;\n    }\n    const jsons = this.contents_.map((text) => JSON.parse(text));\n    this.flyout_?.show(jsons);\n    // TODO: We can remove the setVisible check when updating from ^10.0.0 to\n    //    ^11.\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    if (\n      this.workspace_.scrollbar &&\n      (this.workspace_.scrollbar as any).setVisible\n    ) {\n      (this.workspace_.scrollbar as any).setVisible(false);\n    }\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    Blockly.Events.fire(new BackpackOpen(true, this.workspace_.id));\n  }\n\n  /**\n   * Refreshes backpack flyout contents if the flyout is open.\n   */\n  protected maybeRefreshFlyoutContents() {\n    if (!this.isOpen()) {\n      return;\n    }\n    const json = this.contents_.map((text) => JSON.parse(text));\n    this.flyout_?.show(json);\n  }\n\n  /**\n   * Closes the backpack flyout.\n   */\n  close() {\n    if (!this.isOpen()) {\n      return;\n    }\n    this.flyout_?.hide();\n    // TODO: We can remove the setVisible check when updating from ^10.0.0 to\n    //    ^11.\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    if (\n      this.workspace_.scrollbar &&\n      (this.workspace_.scrollbar as any).setVisible\n    ) {\n      (this.workspace_.scrollbar as any).setVisible(true);\n    }\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    Blockly.Events.fire(new BackpackOpen(false, this.workspace_.id));\n  }\n\n  /**\n   * Hides the component. Called in Blockly.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // The backpack flyout always autocloses because it overlays the backpack UI\n    // (no backpack to click to close it).\n    if (!onlyClosePopups) {\n      this.close();\n    }\n  }\n\n  /**\n   * Handle click event.\n   *\n   * @param e Mouse event.\n   */\n  protected onClick(e: Event) {\n    if (e instanceof MouseEvent && Blockly.browserEvents.isRightButton(e)) {\n      return;\n    }\n    this.open();\n    const uiEvent = new (Blockly.Events.get(Blockly.Events.CLICK))(\n      null,\n      this.workspace_.id,\n      'backpack',\n    );\n    Blockly.Events.fire(uiEvent);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDragEnter(dragElement: Blockly.IDraggable) {\n    if (dragElement instanceof Blockly.BlockSvg) {\n      this.updateHoverStying(true);\n    }\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDragExit(dragElement: Blockly.IDraggable) {\n    this.updateHoverStying(false);\n  }\n\n  /**\n   * Handles a mouseover event.\n   */\n  private onMouseOver() {\n    if (this.isOpenable()) {\n      this.updateHoverStying(true);\n    }\n  }\n\n  /**\n   * Handles a mouseout event.\n   */\n  private onMouseOut() {\n    this.updateHoverStying(false);\n  }\n\n  /**\n   * Adds or removes styling to darken the backpack to show it is interactable.\n   *\n   * @param addClass True to add styling, false to remove.\n   */\n  protected updateHoverStying(addClass: boolean) {\n    const backpackDarken = 'blocklyBackpackDarken';\n    if (this.svgImg_) {\n      if (addClass) {\n        Blockly.utils.dom.addClass(this.svgImg_, backpackDarken);\n      } else {\n        Blockly.utils.dom.removeClass(this.svgImg_, backpackDarken);\n      }\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param dragElement The block or bubble currently\n   *   being dragged.\n   * @returns Whether the block or bubble provided should be returned\n   *   to drag start.\n   */\n  shouldPreventMove(dragElement: Blockly.IDraggable): boolean {\n    return dragElement instanceof Blockly.BlockSvg;\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the backpack is openable.\n   *\n   * @param e A mouse down event.\n   */\n  protected blockMouseDownWhenOpenable(e: Event) {\n    if (\n      e instanceof MouseEvent &&\n      !Blockly.browserEvents.isRightButton(e) &&\n      this.isOpenable()\n    ) {\n      e.stopPropagation(); // Don't start a workspace scroll.\n    }\n  }\n}\n\n/**\n * Base64 encoded data uri for backpack  icon.\n */\nconst backpackSvgDataUri =\n  'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC' +\n  '9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIH' +\n  'ZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiM0NTVBNjQiPjxnPjxyZW' +\n  'N0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PGc+PH' +\n  'BhdGggZD0iTTEzLjk3LDUuMzRDMTMuOTgsNS4yMywxNCw1LjEyLDE0LDVjMC0xLjEtMC45LT' +\n  'ItMi0ycy0yLDAuOS0yLDJjMCwwLjEyLDAuMDIsMC4yMywwLjAzLDAuMzRDNy42OSw2LjE1LD' +\n  'YsOC4zOCw2LDExdjggYzAsMS4xLDAuOSwyLDIsMmg4YzEuMSwwLDItMC45LDItMnYtOEMxOC' +\n  'w4LjM4LDE2LjMxLDYuMTUsMTMuOTcsNS4zNHogTTExLDVjMC0wLjU1LDAuNDUtMSwxLTFzMS' +\n  'wwLjQ1LDEsMSBjMCwwLjAzLTAuMDEsMC4wNi0wLjAyLDAuMDlDMTIuNjYsNS4wMywxMi4zNC' +\n  'w1LDEyLDVzLTAuNjYsMC4wMy0wLjk4LDAuMDlDMTEuMDEsNS4wNiwxMSw1LjAzLDExLDV6IE' +\n  '0xNiwxM3YxdjAuNSBjMCwwLjI4LTAuMjIsMC41LTAuNSwwLjVTMTUsMTQuNzgsMTUsMTQuNV' +\n  'YxNHYtMUg4di0xaDdoMVYxM3oiLz48L2c+PC9nPjwvc3ZnPg==';\n\n/**\n * Base64 encoded data uri for backpack  icon when filled.\n */\nconst backpackFilledSvgDataUri =\n  'data:image/svg+xml;base64,PD94bWwgdmVyc2' +\n  'lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYX' +\n  'RlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2Zw' +\n  'ogICB3aWR0aD0iMjQiCiAgIGhlaWdodD0iMjQiCiAgIHZpZXdCb3g9IjAgMCAyNCAyNCIKIC' +\n  'AgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNSIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3' +\n  'JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj' +\n  '4KICA8ZGVmcwogICAgIGlkPSJkZWZzMiIgLz4KICA8ZwogICAgIGlkPSJsYXllcjEiPgogIC' +\n  'AgPGcKICAgICAgIHN0eWxlPSJmaWxsOiM0NTVhNjQiCiAgICAgICBpZD0iZzg0OCIKICAgIC' +\n  'AgIHRyYW5zZm9ybT0ibWF0cml4KDAuMjY0NTgzMzMsMCwwLDAuMjY0NTgzMzMsOC44MjQ5OT' +\n  'k3LDguODI0OTk5NykiPgogICAgICA8ZwogICAgICAgICBpZD0iZzgyNiI+CiAgICAgICAgPH' +\n  'JlY3QKICAgICAgICAgICBmaWxsPSJub25lIgogICAgICAgICAgIGhlaWdodD0iMjQiCiAgIC' +\n  'AgICAgICAgd2lkdGg9IjI0IgogICAgICAgICAgIGlkPSJyZWN0ODI0IgogICAgICAgICAgIH' +\n  'g9IjAiCiAgICAgICAgICAgeT0iMCIgLz4KICAgICAgPC9nPgogICAgICA8ZwogICAgICAgIC' +\n  'BpZD0iZzgzNCI+CiAgICAgICAgPGcKICAgICAgICAgICBpZD0iZzgyOCIgLz4KICAgICAgIC' +\n  'A8ZwogICAgICAgICAgIGlkPSJnMjIyMyI+CiAgICAgICAgICA8ZwogICAgICAgICAgICAgaW' +\n  'Q9ImcyMTAxNiI+CiAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgIHN0eWxlPSJmaWxsOi' +\n  'M0NTVhNjQiCiAgICAgICAgICAgICAgIGlkPSJnMTQ5MyIKICAgICAgICAgICAgICAgdHJhbn' +\n  'Nmb3JtPSJtYXRyaXgoMy43Nzk1Mjc2LDAsMCwzLjc3OTUyNzYsLTMzLjM1NDMzLC0zMy4zNT' +\n  'QzMykiPgogICAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgICAgaWQ9ImcxNDcxIj4KIC' +\n  'AgICAgICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICAgICAgICBpZD0icmVjdDE0NjkiCi' +\n  'AgICAgICAgICAgICAgICAgICBzdHlsZT0iZmlsbDpub25lIgogICAgICAgICAgICAgICAgIC' +\n  'AgZD0iTSAwLDAgSCAyNCBWIDI0IEggMCBaIiAvPgogICAgICAgICAgICAgIDwvZz4KICAgIC' +\n  'AgICAgICAgICA8ZwogICAgICAgICAgICAgICAgIGlkPSJnMTQ3OSI+CiAgICAgICAgICAgIC' +\n  'AgICA8ZwogICAgICAgICAgICAgICAgICAgaWQ9ImcxNDczIiAvPgogICAgICAgICAgICAgIC' +\n  'AgPGcKICAgICAgICAgICAgICAgICAgIGlkPSJnMTQ3NyI+CiAgICAgICAgICAgICAgICAgID' +\n  'xwYXRoCiAgICAgICAgICAgICAgICAgICAgIGlkPSJwYXRoMTQ3NSIKICAgICAgICAgICAgIC' +\n  'AgICAgICAgZD0ibSAxMiwzIGMgLTEuMSwwIC0yLDAuOSAtMiwyIDAsMC4xMiAwLjAxOTMsMC' +\n  '4yMjk4NDM4IDAuMDI5MywwLjMzOTg0MzggQyA3LjY4OTI5NjUsNi4xNDk4NDMzIDYsOC4zOC' +\n  'A2LDExIHYgOCBjIDAsMS4xIDAuOSwyIDIsMiBoIDggYyAxLjEsMCAyLC0wLjkgMiwtMiBWID' +\n  'ExIEMgMTgsOC4zOCAxNi4zMTA3MDMsNi4xNDk4NDMzIDEzLjk3MDcwMyw1LjMzOTg0MzggMT' +\n  'MuOTgwNzAzLDUuMjI5ODQzOCAxNCw1LjEyIDE0LDUgMTQsMy45IDEzLjEsMyAxMiwzIFogbS' +\n  'AwLDEgYyAwLjU1LDAgMSwwLjQ1IDEsMSAwLDAuMDMgLTAuMDA5NSwwLjA1OTg0NCAtMC4wMT' +\n  'k1MywwLjA4OTg0NCBDIDEyLjY2MDQ2OSw1LjAyOTg0MzggMTIuMzQsNSAxMiw1IDExLjY2LD' +\n  'UgMTEuMzM5NTMxLDUuMDI5ODQzOCAxMS4wMTk1MzEsNS4wODk4NDM4IDExLjAwOTUzMSw1Lj' +\n  'A1OTg0MzggMTEsNS4wMyAxMSw1IDExLDQuNDUgMTEuNDUsNCAxMiw0IFogbSAtMy40NzI2NT' +\n  'YyLDYuMzk4NDM4IGggMS4xNTYyNSB2IDIuNjQwNjI0IGggMC4zMDkzMzU0IGwgLTIuMzdlLT' +\n  'UsLTEuMTcxMTQ2IDEuMDgyNzEwNSwtMTBlLTcgMC4wMTEsMS4xNzExNDYgaCAwLjMzMzMwNC' +\n  'BsIC0wLjAzNTA0LC0yLjU4NzMxNSBoIDAuNTc4MTI1IDAuNTc4MTI1IGwgMC4wMTEwNSwyLj' +\n  'U4NzMxNSBoIDAuMzU2MDI0IFYgMTIuMDYwNTQ3IEggMTQuMDYyNSB2IDAuOTc4NTE1IGggMC' +\n  '4zMzAwNzggdiAtMi41NTI3MzQgaCAxLjE1NjI1IHYgMi41NTI3MzQgaCAwLjk2Njc5NyB2ID' +\n  'AuMzU3NDIyIEggOS42ODM1OTM4IDguNTI3MzQzOCA3LjYwMzUxNTYgdiAtMC4zNTc0MjIgaC' +\n  'AwLjkyMzgyODIgeiIKICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgID' +\n  'wvZz4KICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgIDwvZz' +\n  '4KICAgICAgICA8L2c+CiAgICAgIDwvZz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=';\n\nBlockly.Css.register(`\n.blocklyBackpack {\n  opacity: 0.4;\n}\n.blocklyBackpackDarken {\n  opacity: 0.6;\n}\n.blocklyBackpack:active {\n  opacity: 0.8;\n}\n`);\n\n/**\n * Custom serializer so that the backpack can save and later recall which\n * blocks have been saved in a workspace.\n */\nclass BackpackSerializer {\n  /**\n   * The priority for deserializing block suggestion data.\n   * Should be after blocks, procedures, and variables.\n   */\n  priority = Blockly.serialization.priorities.BLOCKS - 10;\n\n  /**\n   * Saves a target workspace's state to serialized JSON.\n   *\n   * @param workspace the workspace to save\n   * @returns the serialized JSON if present\n   */\n  save(workspace: Blockly.WorkspaceSvg): object[] {\n    const componentManager = workspace.getComponentManager();\n    const backpack = componentManager.getComponent('backpack') as Backpack;\n    return backpack?.getContents().map((text) => JSON.parse(text));\n  }\n\n  /**\n   * Loads a serialized state into the target workspace.\n   *\n   * @param state the serialized state JSON\n   * @param workspace the workspace to load into\n   */\n  load(state: object[], workspace: Blockly.WorkspaceSvg) {\n    const jsonStrings = state.map((j) => JSON.stringify(j));\n    const componentManager = workspace.getComponentManager();\n    const backpack = componentManager.getComponent('backpack') as Backpack;\n    backpack?.setContents(jsonStrings);\n  }\n\n  /**\n   * Resets the state of a workspace.\n   *\n   * @param workspace the workspace to reset\n   */\n  clear(workspace: Blockly.WorkspaceSvg) {\n    const componentManager = workspace.getComponentManager();\n    const backpack = componentManager.getComponent('backpack') as Backpack;\n    backpack?.empty();\n  }\n}\n\ninterface StateWithIndex extends Blockly.serialization.blocks.State {\n  [key: string]: unknown;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Typedefs and utility methods for parsing options for the\n * backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nexport interface BackpackContextMenuOptions {\n  emptyBackpack?: boolean;\n  removeFromBackpack?: boolean;\n  copyToBackpack?: boolean;\n  copyAllToBackpack?: boolean;\n  pasteAllToBackpack?: boolean;\n  disablePreconditionChecks?: boolean;\n}\n\nexport interface BackpackOptions {\n  allowEmptyBackpackOpen?: boolean;\n  useFilledBackpackImage?: boolean;\n  skipSerializerRegistration?: boolean;\n  contextMenu?: BackpackContextMenuOptions;\n}\n\n/**\n * Returns a new options object with all properties set, using default values\n * if not specified in the optional options that were passed in.\n *\n * @param options The options to use.\n * @returns The created options object.\n */\nexport function parseOptions(options?: BackpackOptions): BackpackOptions {\n  const defaults = {\n    allowEmptyBackpackOpen: true,\n    useFilledBackpackImage: false,\n    skipSerializerRegistration: false,\n    contextMenu: {\n      emptyBackpack: true,\n      removeFromBackpack: true,\n      copyToBackpack: true,\n      copyAllToBackpack: false,\n      pasteAllToBackpack: false,\n      disablePreconditionChecks: false,\n    },\n  };\n\n  if (!options) {\n    return defaults;\n  }\n\n  return {\n    allowEmptyBackpackOpen:\n      options.allowEmptyBackpackOpen ?? defaults.allowEmptyBackpackOpen,\n    useFilledBackpackImage:\n      options.useFilledBackpackImage ?? defaults.useFilledBackpackImage,\n    skipSerializerRegistration:\n      options.skipSerializerRegistration ?? defaults.skipSerializerRegistration,\n    contextMenu: {\n      ...defaults.contextMenu,\n      ...options.contextMenu,\n    },\n  };\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Helper and utility methods for the backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport './msg';\n\nimport * as Blockly from 'blockly/core';\n\nimport {Backpack} from './backpack';\nimport {BackpackContextMenuOptions} from './options';\n\n/**\n * Registers a context menu option to empty the backpack when right-clicked.\n *\n * @param workspace The workspace to register the context menu option on.\n */\nfunction registerEmptyBackpack(workspace: Blockly.WorkspaceSvg) {\n  const prevConfigureContextMenu = workspace.configureContextMenu;\n  workspace.configureContextMenu = (menuOptions, e: Event) => {\n    const backpack = workspace\n      .getComponentManager()\n      .getComponent('backpack') as Backpack;\n    const backpackClientRect = backpack && backpack.getClientRect();\n    if (e instanceof PointerEvent && backpackClientRect) {\n      if (!backpack || !backpackClientRect.contains(e.clientX, e.clientY)) {\n        prevConfigureContextMenu &&\n          prevConfigureContextMenu.call(null, menuOptions, e);\n        return;\n      }\n    }\n    menuOptions.length = 0;\n    const backpackOptions = {\n      text: Blockly.Msg['EMPTY_BACKPACK'],\n      enabled: !!backpack.getCount(),\n      callback: function () {\n        backpack.empty();\n      },\n      scope: {\n        workspace,\n      },\n      weight: 0,\n    };\n    menuOptions.push(backpackOptions);\n  };\n}\n\n/**\n * Registers a context menu option to remove a block from a backpack flyout.\n */\nfunction registerRemoveFromBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('remove_from_backpack')) {\n    return;\n  }\n  const removeFromBackpack = {\n    displayText: Blockly.Msg['REMOVE_FROM_BACKPACK'],\n    preconditionFn: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.block) return 'hidden';\n      const ws = scope.block.workspace;\n      if (ws.isFlyout && ws.targetWorkspace) {\n        const backpack = ws.targetWorkspace\n          .getComponentManager()\n          .getComponent('backpack') as Backpack;\n        const backpackFlyout = backpack && backpack.getFlyout();\n        if (\n          backpack &&\n          backpackFlyout &&\n          backpackFlyout.getWorkspace().id === ws.id\n        ) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.block || !scope.block.workspace.targetWorkspace) return;\n      const backpack = scope.block.workspace.targetWorkspace\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      backpack.removeBlock(scope.block);\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'remove_from_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(removeFromBackpack);\n}\n\n/**\n * Registers context menu options for adding a block to the backpack.\n *\n * @param disablePreconditionContainsCheck Whether to disable the\n *   precondition check for whether the backpack contains the block.\n */\nfunction registerCopyToBackpack(disablePreconditionContainsCheck: boolean) {\n  if (Blockly.ContextMenuRegistry.registry.getItem('copy_to_backpack')) {\n    return;\n  }\n  const copyToBackpack = {\n    displayText: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.block) {\n        return '';\n      }\n      const backpack = scope.block.workspace\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      const backpackCount = backpack.getCount();\n      return `${Blockly.Msg['COPY_TO_BACKPACK']} (${backpackCount})`;\n    },\n    preconditionFn: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.block) return 'hidden';\n      const ws = scope.block.workspace;\n      if (!ws.isFlyout) {\n        const backpack = ws\n          .getComponentManager()\n          .getComponent('backpack') as Backpack;\n        if (backpack) {\n          if (disablePreconditionContainsCheck) {\n            return 'enabled';\n          }\n          return backpack.containsBlock(scope.block) ? 'disabled' : 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.block) return;\n      const backpack = scope.block.workspace\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      backpack.addBlock(scope.block);\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'copy_to_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(copyToBackpack);\n}\n\n/**\n * Registers context menu options for copying all blocks from the workspace to\n * the backpack.\n */\nfunction registerCopyAllBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('copy_all_to_backpack')) {\n    return;\n  }\n  const copyAllToBackpack = {\n    displayText: Blockly.Msg['COPY_ALL_TO_BACKPACK'],\n    preconditionFn: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      const ws = scope.workspace;\n      if (ws && !ws.isFlyout) {\n        const backpack = ws.getComponentManager().getComponent('backpack');\n        if (backpack) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      const ws = scope.workspace;\n      if (!ws) return;\n      const backpack = ws\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      backpack.addBlocks(ws.getTopBlocks(true));\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'copy_all_to_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(copyAllToBackpack);\n}\n\n/**\n * Registers context menu options for pasting all blocks from the backpack to\n * the workspace.\n */\nfunction registerPasteAllBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('paste_all_from_backpack')) {\n    return;\n  }\n  const pasteAllFromBackpack = {\n    displayText: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const backpack = scope.workspace\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      const backpackCount = backpack.getCount();\n      return `${Blockly.Msg['PASTE_ALL_FROM_BACKPACK']} (${backpackCount})`;\n    },\n    preconditionFn: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      const ws = scope.workspace;\n      if (ws && !ws.isFlyout) {\n        const backpack = ws.getComponentManager().getComponent('backpack');\n        if (backpack) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function (scope: Blockly.ContextMenuRegistry.Scope) {\n      const ws = scope.workspace;\n      if (!ws) return;\n      const backpack = ws\n        .getComponentManager()\n        .getComponent('backpack') as Backpack;\n      const contents = backpack.getContents();\n      contents.forEach((blockText) => {\n        const block = Blockly.serialization.blocks.append(\n          JSON.parse(blockText),\n          ws,\n        ) as Blockly.BlockSvg;\n        block.scheduleSnapAndBump();\n      });\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'paste_all_from_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(pasteAllFromBackpack);\n}\n\n/**\n * Register all context menu options.\n *\n * @param contextMenuOptions The backpack context menu options.\n * @param workspace The workspace to register the context menu options.\n */\nexport function registerContextMenus(\n  contextMenuOptions: BackpackContextMenuOptions,\n  workspace: Blockly.WorkspaceSvg,\n) {\n  if (contextMenuOptions.emptyBackpack) {\n    registerEmptyBackpack(workspace);\n  }\n  if (contextMenuOptions.removeFromBackpack) {\n    registerRemoveFromBackpack();\n  }\n  if (contextMenuOptions.copyToBackpack) {\n    registerCopyToBackpack(\n      contextMenuOptions.disablePreconditionChecks ?? false,\n    );\n  }\n  if (contextMenuOptions.copyAllToBackpack) {\n    registerCopyAllBackpack();\n  }\n  if (contextMenuOptions.pasteAllToBackpack) {\n    registerPasteAllBackpack();\n  }\n}\n"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__370__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","backpackOpen","BackpackOpen","UiBase","constructor","isOpen","workspaceId","super","type","toJson","json","fromJson","workspace","event","newEvent","register","Type","EVENT","backpackChange","BackpackChange","isBackpackable","toFlyoutInfo","Backpack","workspace_","backpackOptions","id","flyout_","contents_","boundEvents","left_","top_","WIDTH_","HEIGHT_","MARGIN_VERTICAL_","MARGIN_HORIZONTAL_","HOTSPOT_MARGIN_","svgGroup_","svgImg_","spriteTop","spriteLeft","spriteSize","initialized_","options","defaults","allowEmptyBackpackOpen","useFilledBackpackImage","skipSerializerRegistration","contextMenu","emptyBackpack","removeFromBackpack","copyToBackpack","copyAllToBackpack","pasteAllToBackpack","disablePreconditionChecks","parseOptions","registerSerializer","hasItem","SERIALIZER","registry","BackpackSerializer","init","contextMenuOptions","getComponentManager","addComponent","component","weight","capabilities","Capability","AUTOHIDEABLE","DRAG_TARGET","POSITIONABLE","initFlyout","createDom","attachListeners","prevConfigureContextMenu","configureContextMenu","menuOptions","e","backpack","getComponent","backpackClientRect","getClientRect","PointerEvent","contains","clientX","clientY","length","text","enabled","getCount","callback","empty","scope","push","registerEmptyBackpack","getItem","displayText","preconditionFn","block","ws","isFlyout","targetWorkspace","backpackFlyout","getFlyout","getWorkspace","removeBlock","scopeType","ScopeType","BLOCK","registerRemoveFromBackpack","disablePreconditionContainsCheck","backpackCount","containsBlock","addBlock","registerCopyToBackpack","addBlocks","getTopBlocks","WORKSPACE","registerCopyAllBackpack","pasteAllFromBackpack","getContents","forEach","blockText","blocks","append","JSON","parse","scheduleSnapAndBump","registerPasteAllBackpack","resize","dispose","dom","removeNode","unbind","flyoutWorkspaceOptions","scrollbars","parentWorkspace","rtl","RTL","oneBasedIndex","renderer","rendererOverrides","move","horizontalLayout","toolboxPosition","toolbox","Position","TOP","BOTTOM","HorizontalFlyout","getClassFromOptions","FLYOUTS_HORIZONTAL_TOOLBOX","Error","RIGHT","LEFT","VerticalFlyout","FLYOUTS_VERTICAL_TOOLBOX","parentNode","getParentSvg","appendChild","Svg","SVG","createSvgElement","G","rnd","idGenerator","genUid","clip","CLIPPATH","RECT","width","height","IMAGE","setAttributeNS","XLINK_NS","backpackSvgDataUri","insertAfter","getBubbleCanvas","addEvent","blockMouseDownWhenOpenable","onClick","onMouseOver","onMouseOut","node","name","thisObject","func","bind","clientRect","getBoundingClientRect","top","bottom","left","right","Rect","getBoundingRectangle","position","metrics","savedPositions","scrollbar","hasVerticalScrollbars","isVisible","canScrollVertically","hasHorizontalScrollbars","canScrollHorizontally","toolboxMetrics","absoluteMetrics","viewMetrics","scrollbarThickness","startAtBottom","boundingRect","otherEl","intersects","setAttribute","onDrop","dragElement","addBackpackable","blockToJsonString","save","kind","traverseJson","keys","indexOf","stringify","blockXmlToJsonString","blockXml","startsWith","domToBlock","xml","textToDom","containsBackpackable","addItem","removeBackpackable","removeItem","backpackable","every","info","addBackpackables","backpackables","addItems","map","b","reduce","acc","curr","item","items","addedItems","filterDuplicates","unshift","onContentChange","itemIndex","splice","setContents","contents","content","close","maybeRefreshFlyoutContents","fire","backpackFilledSvgDataUri","array","filter","idx","isOpenable","open","jsons","show","setVisible","hide","autoHide","onlyClosePopups","MouseEvent","isRightButton","uiEvent","CLICK","onDragEnter","updateHoverStying","onDragExit","addClass","backpackDarken","removeClass","shouldPreventMove","stopPropagation","priority","priorities","BLOCKS","load","state","jsonStrings","j","clear"],"sourceRoot":""}